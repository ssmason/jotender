jQuery(document).ready(function(e){function t(){p("[section=taxonomies], [section=meta], [section=source]"),e("input.hidden").closest("tr").hide(),e("#templates_list").val(""),e(".rss-load-images").prop("checked",!1)}function a(t,a){var t=t?t:e("[class*=provider-expand]");t.each(function(){var t=e("."+e(this).attr("data-child")),n=e(this).attr("data-default"),o="undefined"==typeof a?t.is(":visible"):a;n=(o?"- ":"+ ")+n,e(this).text(n)})}function n(t){e(".provider-expand-feed-builder").length?e(".provider-expand-feed-builder").click():e(".provider-expand-feed-manual-setup").click(),a(),void 0!==t.feed.query_args_sep&&e(".feed-builder input[name=feed-params-sep]").val(t.feed.query_args_sep),void 0!==t.feed.query_args&&(e("[class*=opt-param]").hide(),e.each(t.feed.query_args,function(t,a){e(".feed-builder .opt-param-"+t).show();var n=Object.keys(a)[0],o=void 0!=a[n].default_value?a[n].default_value:"",i=void 0!=a[n].placeholder?a[n].placeholder:"",r=void 0!=a[n].required?a[n].required:"",s=void 0!=a[n].is_prefix?a[n].is_prefix:"";"domain_l"===n&&e(".feed-builder input[name=feed-param-"+t+"]").attr("data-regex",a[n].regex),r&&e(".feed-builder .opt-param-"+t+" label").append(" "+r),e(".feed-builder input[name=feed-param-"+t+"]").val(n),e(".feed-builder input[name=feed-param-"+t+"]").attr("data-default",o),i&&e(".feed-builder input[name=feed-"+t+"]").attr("placeholder",i),s&&e(".feed-builder input[name=feed-param-"+t+"]").attr("data-prefix",s)})),e(".feed-builder input[name=feed-url]").val(t.feed.base_url).keyup(),e(".feed-builder input[name=feed-url]").attr("data-default",t.feed.base_url)}function o(){var t=e("input[name=feed-url]").val(),a=e(".feed-builder input[name=feed-params-sep]").val();return"undefined"==typeof t?t:("&"===a?t+=t.indexOf("?")<0?"?":"&":t.indexOf(a)<0&&(t+=a),t)}function i(t){var a=v,n=e(".feed-builder input[name=feed-params-sep]").val(),o=[];e(".feed-builder .params input[name*=feed-]").each(function(){var a=e(this).attr("data-qarg"),n=e("input[name="+a+"]").attr("data-default");n=void 0!=n?n:"",value=void 0!=t[a]?t[a]:"",o[a]=value?value:n}),t=o;for(var i in t)t.hasOwnProperty(i)&&void 0!=t[i]&&void 0!=t[i]&&(("&"===n&&"?"!==a.slice(-1)||"&"!==n)&&n!==a.slice(-1)&&(a+=n),a+=t[i]);e(".provider-rss-custom").text(a),e(".provider-rss-custom").prop("href",a)}function r(t){var a=e("#rss_feed_import").val().split("?")[0];if(void 0!==e("#rss_feed_import").attr("data-saved-url"))var n=e("#rss_feed_import").attr("data-saved-url").split("?")[0];return a!==n}function s(t,a){e.each(t,function(t,n){a||e('input[name="source['+t+']"]').val(n).change(),e('input[name="source['+t+']"]').attr("data-original",n).change()}),p("[section=source]")}function d(t){var a=[];void 0!==goft_wpjm_admin_l18n.default_query_args&&a.push(goft_wpjm_admin_l18n.default_query_args),void 0!==t.feed&&a.push(t.feed.query_args),e.each(a,function(t,a){void 0!==a&&e.each(a,function(t,a){var n="";""!==Object.keys(a)[0]&&0===Object.keys(a)[0]?(n=a,t=n):n=Object.keys(a)[0],param_value=_(e("#rss_feed_import").val(),n),e("input[data-core-name="+t+"]").val(param_value).change()})})}function l(t){t?(e(".import-notes").closest("tr").hide(),e(".import-posts").fadeIn()):(e(".import-notes").closest("tr").fadeIn(),e(".import-posts").hide()),c(t)}function p(t){var a="";e(t).each(function(){var t=e(this).attr("section"),n="section-"+t+"-values",o=e(this).closest("tr"),i=e("th",o).text(),r="-";if(e('select, input[type!="button"], textarea',o).each(function(){if(value="",e(this).is("select"))value=e(this).find(":selected").text();else if(e(this).is(":checkbox"))value=e(this).is(":checked")?goft_wpjm_admin_l18n.label_yes:goft_wpjm_admin_l18n.label_no;else if(e(this).val()){if(value=e(this).val(),u(value)){var t=document.createElement("a");t.href=value,null!==t.pathname.match(/\.(jpeg|jpg|gif|png|ico)$/)?value='<img src="'+value+'" class = "goft-image-thumb">':value='<a href="'+value+'" class = "goft-link">'+value+"</a>"}}else""!==e(this).attr("data-default")&&(value=e(this).attr("data-default"))}),t!==a)if(e("."+n).length)e("."+n).html("");else{var s='<tr class="section-advanced temp-tr-hide"><td><a href="#" class="section-expand" expand="'+t+'">'+goft_wpjm_admin_l18n.msg_advanced+'</a></td><td class="tip">&nbsp;</td><td class="section-values '+n+'" colspan=5></td></tr>';e(".section-"+t).parents("tr").after(s)}value||(value=r);var d='<p class="goft-basic"><strong>'+i+": </strong>"+value+"</p> ";e("."+n).append(d),a=t})}function c(t){var a=e(".temp-tr-hide"),n=e(".temp-tr-hide.tr-hide");t?a.fadeIn():(a.fadeOut(),n.removeClass("temp-tr-hide"))}function f(e){var t,a=/\/\/www\.(.*?)[\/\?]$/;if(null!==(t=a.exec(e)))for(var n=(t.length,t.length-1);n>=0;n--)if(void 0!==t[n]&&""!==t[n])return"rss-"+t[n];return"my-rss-feed"}function u(e){var t=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.\!\/\\\w]*))?)/g,a=new RegExp(t);return a.test(e)}function _(e,t){t=t.replace(new RegExp("]","gm"),/[\[]/,"\\[").replace(new RegExp("]","gm"),/[\]]/,"\\]");var a=new RegExp("[\\?&/]"+t+".([^&#/]*)"),n=a.exec(e);return null===n?"":decodeURIComponent(n[1].replace(new RegExp("]","gm"),/\+/g," "))}var v="",g=[],h="",j=e("#templates_list + .description"),w=(e("form[name=post]").validate({errorElement:"div",errorPlacement:function(e,t){e.insertAfter(t.closest("label"))}}),{details:"form",detailsAttribute:"data-geo"});e(".geocomplete").length&&e(".geocomplete").geocomplete(w),e("#from_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,onClose:function(t){e("#to_date").datepicker("option","minDate",t),e("#to_date").val()||e("#to_date").val(e("#from_date").val())}}),e("#to_date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,onClose:function(t){e("#from_date").datepicker("option","maxDate",t)}}),t(),e(document).on("click",".refresh-templates",function(t){e("#templates_list option").filter(function(){return this.value}).remove(),e(".goft_wpjm.processing.templates").length||(j.hide().after('<div class="goft_wpjm processing templates">&nbsp;</div>'),e(".import-feed").prop("disabled",!0));var a={action:"goft_wpjm_update_templates_list",_ajax_nonce:goft_wpjm_admin_l18n.ajax_nonce};return e.post(goft_wpjm_admin_l18n.ajaxurl,a,function(t){void 0!==t&&void 0!==t.templates&&(e.each(t.templates,function(t,a){e("#templates_list option[value='"+a+"']").length||e("#templates_list").append(e("<option>",{value:a}).text(a))}),e("#templates_list").trigger("change")),e(".goft_wpjm.processing.templates").remove(),e(".import-feed").prop("disabled",!1),j.show()},"json"),t.preventDefault(),!1}),e(document).on("click",".import-feed",function(t){var a=e("#rss_feed_import").val();if(!a)return void alert(goft_wpjm_admin_l18n.msg_specify_valid_url);l(!1),e(".goft_wpjm.no-jobs-found").remove(),e(".goft_wpjm.processing.feed").length||(e("input[name=import_feed]").hide(),e("input[name=import_feed]").after('<span class="goft_wpjm processing feed">&nbsp;</span>').after('<a class="button-secondary cancel-feed-load">'+goft_wpjm_admin_l18n.cancel_feed_load+"</a>"),e("input",j).prop("disabled",!0));var n={action:"goft_wpjm_import_feed",url:a,load_images:e("input[name=load_images]").is(":checked"),force_feed:e("input[name=force_feed]").is(":checked"),_ajax_nonce:goft_wpjm_admin_l18n.ajax_nonce};return h=e.post(goft_wpjm_admin_l18n.ajaxurl,n,function(t){if(void 0!==t)if(l(!1),void 0!==t.error)e(".force-feed").show(),e("input[name=load_images]").closest("p").after('<span class="goft_wpjm no-jobs-found feed"> '+goft_wpjm_admin_l18n.msg_invalid_feed+": "+t.error);else if(t.total_items>0){e(".goft_wpjm_jobs_found").remove(),e(".goft_wpjm_table").html(t.sample_item),e(".goft_wpjm_table").after('<h4 class="goft_wpjm_jobs_found code">'+goft_wpjm_admin_l18n.msg_jobs_found+": "+t.total_items+"</h4>");var n=e("#templates_list").val()&&!r();t.provider&&(s(t.provider,n),d(t.provider)),e("#templates_list").val()||e("#template_name").val(f(a)),c(!0),l(!0),e.event.trigger({type:"goftj_rss_content_loaded"})}else e("input[name=load_images]").closest("p").after('<span class="goft_wpjm no-jobs-found feed"> '+goft_wpjm_admin_l18n.msg_no_jobs_found+"</span>");e(".goft_wpjm.processing").remove(),e(".cancel-feed-load").remove(),e("input[name=import_feed]").show(),e("input",j).prop("disabled",!1),p("[section=taxonomies], [section=meta], [section=source]")},"json"),t.preventDefault(),!1}),e(document).on("click",".cancel-feed-load",function(t){return h.abort(),e(this).remove(),e(".goft_wpjm.processing").remove(),e("input[name=import_feed]").show(),e("input",j).prop("disabled",!1),t.preventDefault(),!1}),e(document).on("click",".save-template",function(t){var a=e("#template_name").val();if(!a)return void alert(goft_wpjm_admin_l18n.msg_template_missing);e(".goft_wpjm.processing.save").length||(e(".save-template").hide(),e(".save-template").after('<span class="goft_wpjm processing save">&nbsp;</span>'));var n={action:"goft_wpjm_save_template",template:a,fetch_images:Number(e("input[name=load_images]").is(":checked")),force_feed:Number(e("input[name=force_feed]").is(":checked")),rss_feed_import:e("#rss_feed_import").val(),_wpnonce:goft_wpjm_admin_l18n.ajax_save_nonce};return e.each(["tax_input","meta","source"],function(t,a){e('[name*="'+a+'"]').each(function(t,a){e(a).is(":checkbox")?n[e(this).prop("name")]=e(a).is(":checked")?e(this).attr("data-default"):"":n[e(this).prop("name")]=e(this).val()})}),e.post(goft_wpjm_admin_l18n.ajaxurl,n,function(t){void 0!==t&&(e(".save-template").show(),e(".save-template").after('<span class="template-saved-msg"> '+goft_wpjm_admin_l18n.msg_template_saved+"</span>"),e(".template-saved-msg").delay(2e3).fadeOut(),e("#templates_list option[value='"+a+"']").length||e("#templates_list").append(e("<option>",{value:a}).text(a)),e("#templates_list").val(a)),e(".goft_wpjm.processing.save").remove()}),t.preventDefault(),!1}),e(document).on("change","#templates_list",function(){var t=e(this);c(!1),l(!1),e(".goft_wpjm.processing.templates").length||j.hide().after('<div class="goft_wpjm processing templates">&nbsp;</div>');var a={action:"goft_wpjm_load_template_content",template:e(this).val(),_ajax_nonce:goft_wpjm_admin_l18n.ajax_nonce};e.post(goft_wpjm_admin_l18n.ajaxurl,a,function(a){if(a){var n=a.rss_feed_import;e("#rss_feed_import").val(n),e("#template_name").val(t.val()),e("input[name=load_images]").prop("checked",Boolean(a.fetch_images)),e("input[name=force_feed]").prop("checked",Boolean(a.force_feed)),e("#rss_feed_import").attr("data-saved-url",n),e.each(["tax_input","meta","source"],function(t,n){e.each(a[n],function(t,a){var o='[name="'+n+"["+t+']"]';if(e(o).is(":checkbox"))return void(a?e(o).prop("checked",!0):(e(o).val(e(o).attr("data-default")),e(o).prop("checked",!1)));if(e(o).val(a).prop("selected",!0).change(),e(o).hasClass("goft-image")&&a){var i=e(o).closest("td");e("img",i).attr("src",a)}})}),e(".import-feed").click(),e(".force-feed").toggle(e("input[name=force_feed]").is(":checked"))}else e("#rss_feed_import").val("");e(".goft_wpjm.processing.templates").remove(),j.show()},"json"),e("#providers_list").val("").change()}),e("[section=taxonomies],[section=meta], [section=source]").on("change",function(){p("[section="+e(this).attr("section")+"]")}),e(document).on("change","#providers_list",function(){if(e(".goft_wpjm.processing.providers").remove(),!e(this).val())return void e(".providers-placeholder").closest("tr").fadeOut();e(".goft_wpjm.processing.templates").length||e("#providers_list").after('<div class="goft_wpjm processing providers">&nbsp;</div>');var t={action:"goft_wpjm_load_provider_info",provider:e(this).val(),_ajax_nonce:goft_wpjm_admin_l18n.ajax_nonce};e.post(goft_wpjm_admin_l18n.ajaxurl,t,function(t){t&&(e(".providers-placeholder-content").html(t.setup).closest("tr").fadeIn(),e(".providers-placeholder").slideDown(),n(t.provider)),e(".goft_wpjm.processing.providers").remove()},"json"),v="",g=[]}),e(document).on("click","a.provider-rss, a.provider-rss-custom",function(t){return e(".rss-copied-msg").remove(),e("input[name=rss_feed_import]").val(e(this).attr("href")),e(this).after('<span class="rss-copied-msg"> '+goft_wpjm_admin_l18n.msg_rss_copied+"</span>").fadeIn(),e(".rss-copied-msg").delay(1e3).fadeOut(),t.preventDefault(),!1}),e(document).on("click","[class*=provider-expand]",function(t){var n=e(this),o=e("."+n.attr("data-child"));return o.slideToggle(a(n,!o.is(":visible"))),t.preventDefault(),!1}),e(document).on("keyup",".feed-builder input[name*=feed]",function(){var t=e(this).attr("data-qarg"),a=e("input[name="+t+"]").val(),n=e(this).val(),o=e(".feed-builder input[name=feed-params-sep]").val(),r=e("input[name="+t+"]").attr("data-prefix");g[t]=[],n.length||(n=""),n=encodeURIComponent(n),a+="&"===o?"="+n:(r?"":o)+n,g[t]=a,i(g)}),e(document).on("keyup",".feed-builder input[name=feed-url]",function(){v=o();var t="domain_l"===e(".feed-builder input[name=feed-param-location]").val();if(t){var a=new RegExp(e(".feed-builder input[name=feed-param-location]").attr("data-regex"));null!==(m=a.exec(v))&&e(".feed-builder input[name=feed-location]").val(m[1])}e(".feed-builder .params input[name*=feed-]:visible").keyup()}),e(document).on("click",".reset-feed-url",function(t){return e(".feed-builder input[name=feed-url]").val(e(".feed-builder input[name=feed-url]").attr("data-default")).keyup(),t.preventDefault(),!1}),e(document).on("click",".clear_span_dates",function(){e("."+e(this).attr("data-goft_parent")).val("")}),e(document).on("click",".reset-val",function(t){var a=e('input[name="'+e(this).attr("data-parent")+'"');return e(a).val(e(a).attr("data-original")).change(),t.preventDefault(),!1}),e(".section-expand").on("click",function(t){var a=e(this).attr("expand"),n="[section="+a+"]",o=this;return e(".section-"+a+"-values").toggle().addClass("temp-tr-hide"),e(n).closest("tr").toggle(function(){e(this).addClass("temp-tr-hide"),e(this).is(":visible")?e(o).text(goft_wpjm_admin_l18n.simple):e(o).text(goft_wpjm_admin_l18n.advanced)}),p("[section=taxonomies], [section=meta], [section=source]"),t.preventDefault,!1}),e("#_goft_wpjm_period_custom").closest("tr").hide(),e(document).on("change","#_goft_wpjm_period",function(){"custom"==e(this).val()?e("#_goft_wpjm_period_custom").closest("tr").fadeIn():e("#_goft_wpjm_period_custom").closest("tr").hide()}),e("#_goft_wpjm_period").trigger("change")});